<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#6a3d7b" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VOS Absensi</title>
    
    <!-- PWA Manifest with ID for dynamic injection -->
    <link rel="manifest" href="manifest.json" id="app-manifest">
    
    <!-- Script to dynamically update manifest icon based on DB settings or Default Theme -->
    <script>
      (function() {
        try {
          // 1. Define the Default Logo (Purple Square + Music Icon) matching Home Page style
          // We use an SVG Data URI so it looks perfect without needing an external file
          const defaultSvg = `
            <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 24 24">
              <rect width="24" height="24" fill="#6a3d7b" rx="6" />
              <path d="M9 18V5l12-2v13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              <circle cx="6" cy="18" r="3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
              <circle cx="18" cy="16" r="3" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          `.trim();
          const defaultIconUrl = "data:image/svg+xml;base64," + btoa(defaultSvg);

          // 2. Helper to set manifest
          const setManifest = (iconUrl, isSvg = false) => {
            const manifestLink = document.getElementById('app-manifest');
            // If using the generated SVG, use specific mime type, otherwise PNG
            const type = isSvg ? "image/svg+xml" : "image/png";
            
            const dynamicManifest = {
              "short_name": "VOS Absensi",
              "name": "Voice of Soul Attendance",
              "icons": [
                { "src": iconUrl, "sizes": "192x192", "type": type },
                { "src": iconUrl, "sizes": "512x512", "type": type }
              ],
              "start_url": ".",
              "display": "standalone",
              "theme_color": "#6a3d7b",
              "background_color": "#f8fafc",
              "orientation": "portrait"
            };
            
            const blob = new Blob([JSON.stringify(dynamicManifest)], {type: 'application/json'});
            manifestLink.href = URL.createObjectURL(blob);
            
            // Also update apple touch icon
            const appleIcon = document.getElementById('apple-icon');
            if (appleIcon) appleIcon.href = iconUrl;
          };

          // 3. Check LocalStorage for Custom Logo from DB
          const savedState = localStorage.getItem('vos_app_state');
          let customLogo = null;
          
          if (savedState) {
            const parsed = JSON.parse(savedState);
            if (parsed.appLogoUrl) customLogo = parsed.appLogoUrl;
          }

          // 4. Apply Custom Logo OR Default Theme Logo
          if (customLogo) {
            console.log('Using Custom DB Logo for PWA');
            setManifest(customLogo, false);
          } else {
            console.log('Using Default Theme Logo for PWA');
            setManifest(defaultIconUrl, true);
          }

        } catch(e) { console.log('Error init manifest:', e); }
      })();
    </script>

    <link rel="apple-touch-icon" id="apple-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxyZWN0IHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iIzZhM2Q3YiIgcng9IjYiIC8+PHBhdGggZD0iTTkgMThWNWwxMi0ydjEzIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjxjaXJjbGUgY3g9IjYiIGN5PSIxOCIgcj0iMyIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9Im5vbmUiLz48Y2lyY2xlIGN4PSIxOCIgY3k9IjE2IiByPSIzIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              purple: {
                50: '#f7f4f9',
                100: '#efe8f3',
                200: '#dfd2e7',
                300: '#c6b0d6',
                400: '#a885c0',
                500: '#8c5fa8',
                600: '#6a3d7b',
                700: '#583265',
                800: '#4a2b53',
                900: '#3d2444',
                950: '#26112c',
              }
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/app.css">
    <script type="importmap">
    {
      "imports": {
        "react/": "https://esm.sh/react@^19.2.3/",
        "react": "https://esm.sh/react@^19.2.3",
        "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
        "react-router-dom": "https://esm.sh/react-router-dom@^7.12.0",
        "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
      }
    }
    </script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>